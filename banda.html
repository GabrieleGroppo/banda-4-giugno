<!DOCTYPE html>
<html lang="it">
<head>
    <title>Profilo Banda 4 Giugno 1859</title>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="/images/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="script.js"></script>
</head>
<body>
    <div class="w3-top">
        <div class="w3-bar w3-card custom-bg">
            <a href="javascript:history.back()" class="w3-bar-item w3-button w3-padding-large w3-hide-small">Go Back</a>
        </div>
    </div>

    <div class="w3-content w3-padding-64" style="max-width:2000px;">
        <div class="w3-container w3-content w3-center w3-padding-32" style="max-width:800px">
            <h2 class="w3-wide w3-padding-32">Banda 4 Giugno 1859</h2>
            <img src="images/banda.jpg" alt="Foto della banda" style="width:100%; max-width:800px; border-radius: 10px;">
            <p class="w3-justify w3-padding-16 w3-center">La Banda 4 Giugno 1859 è un'istituzione musicale con una lunga tradizione, che porta la passione per la musica in tutta la comunità.</p>
        </div>

        <div class="w3-container w3-content w3-center w3-padding-32" style="max-width:800px">
            <h3>Bandisti</h3>
            <select id="strumentoFiltro" class="w3-select w3-margin-bottom" onchange="filtraBandisti()">
                <option value="">Tutti gli strumenti</option>
            </select>
            <div id="bandisti-container" class="w3-card-4 w3-padding"></div>
        </div>
    </div>

    <script>
        let bandisti = [];

        async function caricaBandisti() {
            const response = await fetch('bandisti.csv');
            const data = await response.text();
            const righe = data.split('\n').map(riga => riga.trim()).filter(riga => riga);
            
            let strumenti = new Set();
            bandisti = [];
            
            righe.forEach((riga, index) => {
                if (index > 0) { // Ignora intestazione
                    let [nome, strumento, ruolo] = riga.split(',');
                    bandisti.push({ nome, strumento: strumento.trim(), ruolo: ruolo.trim() });
                    strumenti.add(strumento.trim());
                }
            });

            let filtro = document.getElementById("strumentoFiltro");
            strumenti.forEach(strumento => {
                let option = document.createElement("option");
                option.value = strumento;
                option.textContent = strumento;
                filtro.appendChild(option);
            });

            mostraBandisti(bandisti);
        }

        function mostraBandisti(lista) {
            let container = document.getElementById("bandisti-container");
            container.innerHTML = "";
            let strumentiGruppi = {};

            lista.forEach(({ nome, strumento, ruolo }) => {
                if (!strumentiGruppi[strumento]) {
                    strumentiGruppi[strumento] = [];
                }
                strumentiGruppi[strumento].push(`${nome} - ${ruolo}`);
            });

            Object.keys(strumentiGruppi).forEach(strumento => {
                let section = document.createElement("div");
                section.className = "w3-margin-bottom";
                section.innerHTML = `<h4 style="color: gold">${strumento}</h4><ul class='w3-ul'>` + 
                    strumentiGruppi[strumento].map(item => `<li class='w3-padding-8' style='color: white'">${item}</li>`).join('') + "</ul>";
                container.appendChild(section);
            });
        }

        function filtraBandisti() {
            let filtro = document.getElementById("strumentoFiltro").value;
            let filtrati = filtro ? bandisti.filter(b => b.strumento === filtro) : bandisti;
            mostraBandisti(filtrati);
        }

        window.onload = caricaBandisti;
    </script>
    
    <div id="footer-container"></div>
</body>
</html>
